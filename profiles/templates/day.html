{% extends 'profile.html' %}
{% load static %}
{% block content %}
    <body class="bg-gradient-primary">

    <div class="container">

    <div class="card o-hidden border-0 shadow-lg my-5">

    <div class="row">


        <div class="user-creation-form">
            <form method="post" enctype="multipart/form-data">

                {% csrf_token %}
                {% if messages %}
                    <ul class="messages">
                        {% for message in messages %}
                            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                {% for f in form %}
                    <p><label class="form-label" for="{{ f.id_for_label }}"> {{ f.label }}: </label> {{ f }}</p>
                    <div class="form-error">{{ f.errors }}</div>
                {% endfor %}

                <button type="submit" class="btn btn-facebook btn-user btn-block"> Сохранить</button>

            </form>
        </div>

            <a href="{% url 'profile:profile' user.username %}" class="btn-primary col-lg-3 w-25"> Галя, у нас отмена!!!</a>
    </div>

{% endblock %}
{% block extrascripts %}
    <script>
        let avg_temp_koef = 0
        let distance_koef = [
            [4.999, 1, 1], [9.999, 1.1, 2.1],
            [14.999, 1.2, 3.3], [19.999, 1.3, 4.6],
            [24.999, 1.4, 6], [29.999, 1.5, 7.5],
            [34.999, 1.6, 9.1], [39.999, 1.7, 10.8],
            [44.999, 1.8, 12.6], [49.999, 1.9, 14.5],
            [50, 2, 16.5]
        ]

        let temp_koef = {
            "00:02:38": 2.71,
            "00:02:41": 2.72,
            "00:02:44": 2.70,
            "00:02:47": 2.68,
            "00:02:50": 2.66,
            "00:02:53": 2.64,
            "00:02:56": 2.62,
            "00:02:59": 2.60,
            "00:03:02": 2.58,
            "00:03:05": 2.56,
            "00:03:08": 2.54,
            "00:03:11": 2.52,
            "00:03:14": 2.50,
            "00:03:17": 2.48,
            "00:03:20": 2.46,
            "00:03:23": 2.44,
            "00:03:26": 2.42,
            "00:03:29": 2.40,
            "00:03:32": 2.38,
            "00:03:35": 2.36,
            "00:03:38": 2.34,
            "00:03:41": 2.32,
            "00:03:44": 2.30,
            "00:03:47": 2.28,
            "00:03:50": 2.26,
            "00:03:53": 2.24,
            "00:03:56": 2.22,
            "00:03:59": 2.20,
            "00:04:02": 2.18,
            "00:04:05": 2.16,
            "00:04:08": 2.14,
            "00:04:11": 2.12,
            "00:04:14": 2.10,
            "00:04:17": 2.08,
            "00:04:20": 2.06,
            "00:04:23": 2.04,
            "00:04:26": 2.02,
            "00:04:29": 2.0,
            "00:04:32": 1.98,
            "00:04:35": 1.96,
            "00:04:38": 1.94,
            "00:04:41": 1.92,
            "00:04:44": 1.90,
            "00:04:47": 1.88,
            "00:04:50": 1.86,
            "00:04:53": 1.84,
            "00:04:56": 1.82,
            "00:04:59": 1.80,
            "00:05:02": 1.78,
            "00:05:05": 1.76,
            "00:05:08": 1.74,
            "00:05:11": 1.72,
            "00:05:14": 1.70,
            "00:05:17": 1.68,
            "00:05:20": 1.66,
            "00:05:23": 1.64,
            "00:05:26": 1.62,
            "00:05:29": 1.60,
            "00:05:32": 1.58,
            "00:05:35": 1.56,
            "00:05:38": 1.54,
            "00:05:41": 1.52,
            "00:05:44": 1.50,
            "00:05:47": 1.48,
            "00:05:50": 1.46,
            "00:05:53": 1.44,
            "00:05:56": 1.42,
            "00:05:59": 1.40,
            "00:06:02": 1.38,
            "00:06:05": 1.36,
            "00:06:08": 1.34,
            "00:06:11": 1.32,
            "00:06:14": 1.30,
            "00:06:17": 1.28,
            "00:06:20": 1.26,
            "00:06:23": 1.24,
            "00:06:26": 1.22,
            "00:06:29": 1.20,
            "00:06:32": 1.18,
            "00:06:35": 1.16,
            "00:06:38": 1.14,
            "00:06:41": 1.12,
            "00:06:44": 1.10,
            "00:06:47": 1.08,
            "00:06:50": 1.06,
            "00:06:53": 1.04,
            "00:06:56": 1.02,
            "00:06:59": 1.0,
            "00:07:02": 0.99,
            "00:07:05": 0.98,
            "00:07:08": 0.97,
            "00:07:11": 0.96,
            "00:07:14": 0.95,
            "00:07:17": 0.94,
            "00:07:20": 0.93,
            "00:07:23": 0.92,
            "00:07:26": 0.91,
            "00:07:29": 0.90,
            "00:07:32": 0.89,
            "00:07:35": 0.88,
            "00:07:38": 0.87,
            "00:07:41": 0.86,
            "00:07:44": 0.85,
            "00:07:47": 0.84,
            "00:07:50": 0.83,
            "00:07:53": 0.82,
            "00:07:56": 0.81,
            "00:07:59": 0.80,
            "00:08:02": 0.79,
            "00:08:05": 0.78,
            "00:08:08": 0.77,
            "00:08:11": 0.76,
            "00:08:14": 0.75,
            "00:08:17": 0.74,
            "00:08:20": 0.73,
            "00:08:23": 0.72,
            "00:08:26": 0.71,
            "00:08:29": 0.70,
            "00:08:32": 0.69,
            "00:08:35": 0.68,
            "00:08:38": 0.67,
            "00:08:41": 0.66,
            "00:08:44": 0.65,
            "00:08:47": 0.64,
            "00:08:50": 0.63,
            "00:08:53": 0.62,
            "00:08:56": 0.61,
            "00:08:59": 0.60,
            "00:09:02": 0.59,
            "00:09:05": 0.58,
            "00:09:08": 0.57,
            "00:09:11": 0.56,
            "00:09:14": 0.55,
            "00:09:17": 0.54,
            "00:09:20": 0.53,
            "00:09:23": 0.52,
            "00:09:26": 0.51,
            "00:09:29": 0.50,
            "00:09:32": 0.49,
            "00:09:35": 0.48,
            "00:09:38": 0.47,
            "00:09:41": 0.46,
            "00:09:44": 0.45,
            "00:09:45": 0.44,
            "00:09:48": 0.43,
            "00:09:51": 0.42,
            "00:09:54": 0.41,
            "00:09:57": 0.40,
            "00:10:00": 0.39
        }

        document.querySelector('form').addEventListener('change', calcball);
        document.querySelector('form').addEventListener('input', calcball);
        let tot_koef, ost_dist, ost_koef
        let ball = document.getElementById('ball')
        let listoff

        function calcball(event) {
            if (event.target.tagName === 'INPUT') {
                let temp = document.getElementById('temp').value
                let distance = document.getElementById('day_distance').value


                for (const key in temp_koef) {
                    if (temp <= key) {
                        avg_temp_koef = temp_koef[key]
                        break
                    }
                }

//https://doka.guide/js/array-find/
                for (let d of distance_koef) {
                    if (distance <= d[0]) {
                        let need_list_index
                        if (distance < 5) {
                            need_list_index = 0
                        } else if (distance >= 5 && distance < 10) {
                            need_list_index = 1
                        } else {
                            need_list_index = distance_koef.indexOf(d) - 1
                            //listoff =distance_koef.findIndex(item=>distance<=item[0])
                        }

                        let ost_dist
                        let ost_koef
                        if (distance >= 5) {
                            ost_dist = distance - distance_koef[need_list_index][0]
                            ost_koef = (distance_koef[need_list_index][1] + 0.1) * ost_dist
                        } else {
                            ost_dist = distance
                            ost_dist = distance_koef[need_list_index][1] * ost_dist
                        }
                        tot_koef = (5 * distance_koef[need_list_index][2] + ost_koef) * avg_temp_koef;
                        break;
                    }

                }

            }
            if (tot_koef) {
                ball.value = Math.round(tot_koef)
            } else {
                ball.value = 0
            }
        }
    </script>

{% endblock %}
{#{% block calend %}#}
{#    {% for value in calend %}#}
{##}
{#        <a href="/day_selected/{{ value }}" class="day-selected">{{ value }}</a>#}
{##}
{#    {% endfor %}#}
{#{% endblock %}#}